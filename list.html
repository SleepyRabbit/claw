<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
  <!--<link rel="stylesheet" type="text/css" href="asserts/icon/icomoon/style.css" />-->
  <link rel="stylesheet" type="text/css" href="css/common.css" />
  <title>List</title>

  <style type="text/css">
    .head {
      height: 80px;
      background-color: rgb(241, 233, 49);
    }

    .content {}

    .content-banner {
      height: 140px;
      border-top: 2px solid white;
      /*background-color: rgb(241,233,49);*/
      background-color: red;
    }

    .content-list {
      /*background-color: aqua;*/
      padding: 10px;
    }

    .list-container {
      /*background-color: bisque;*/
      width: 50%;
      height: 250px;
      /*border: 1px solid black;*/
    }

    .list-container a {
      text-decoration: none;
      width: 90%;
      color: black;
      /*background-color: aqua;*/
    }

    .list-container a:active {
      color: black;
    }

    .img-container {
      height: 75%;
      /*background-color: red;*/
      border: 1px solid pink;
    }

    img {
      width: 100%;
      height: 90%;
    }

    .list-container a h4 {
      margin-left: 10px;
      margin-top: 3px;
    }

    .list-container a h5 {
      margin-left: 10px;
      /*padding-top: 2px;*/
    }
  </style>
</head>

<body class="flex flex-direction-column">
  <div class="head flex-shrink-0">

  </div>

  <div class="content flex-grow-1 flex flex-direction-column overflow-y-scroll">

    <div class="content-list flex-grow-1 flex flex-wrap-wrap">


<!-- 以下部分代码 作为模板方式填充

<div class="list-container flex flex-justify-content-center">
  <a href="#" onclick="onSelect(idx)">
    <div class="img-container flex flex-direction-column">
      <img src=item.img alt="">  这里使用
      <h5 class="flex-grow-1">
        item.scene.status == ready 空闲中
        item.scene.status == busy 游戏中
        item.scene.status == sleep 待机中
      </h5>
    </div>
    <h4>这里使用 item.title</h4>
    <h5>item.fee/次</h5>
  </a>
</div>


-->



    </div>
  </div>

</body>
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="//cdn.bootcss.com/jquery-weui/1.0.1/js/jquery-weui.min.js"></script>

<script type="text/javascript">
  var glbList = [];
  $(function(){
    //先获取jwt参数
    var jwt = $.urlParam('jwt') || "";
    if(!jwt){
      alert("该页面不能直接在浏览器打开哦~");
      return;
    }
    //去服务器取数据
    $.ajax({
        type: 'GET',
        url: "https://ucast.cc/api/v1/games",
        dataType: 'json',
        beforeSend: function(xhr) {
          xhr.setRequestHeader('Authorization', "bearer " + jwt);
        }
      })
      .done((dat) => {
        console.log(dat);
        glbList = dat;
/* 数据类如：
[ {
    img: "http://img14.360buyimg.com/n1/g16/M00/01/13/rBEbRlNrQy4IAAAAAAMSAcUO_u8AAAUEwPB7PQAAxIZ643.jpg",
    title: "自带乾坤袋哆啦A梦",
    fee: 30,
    scene: {  //场景侧(现场)信息
      sceneDID: 10003,
      state: "ready", // / "busy" / "sleep",
      ctrlUrl: "wss://edge01.ucast.cc",
      uLogicName: "clawSimple"
    }
  },
  ...
]
*/

        //这里渲染ui

      })
      .fail(function(jqXHR, textStatus) {
        alert("账户有问题哦，截图发给技术蝈蝈领金币哦~");
      });


  })

  function onSelect(idx) {
    //这里是关键代码，将选取的游戏信息提交给native
    window.WebViewJavascriptBridge.callHandler(
      'onListItemSelect',
      glbList[idx],
      (responseData)=>{console.log(responseData);}
    );
  }

  $.urlParam = function(name) {
    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
    if (results)
      return results[1] || 0;
    else
      return null;
  }
</script>

</html>
